<?phpsession_start();include($_SESSION['ROOT_DIR'] . '/config.php');if (!$_SESSION['login']){    include($_SESSION['ROOT_DIR'] . '/admin/LoginForm.php');    return;}$panelId = mysql_real_escape_string($_POST['panelId']);$name = mysql_real_escape_string($_POST['name']);$class = mysql_real_escape_string($_POST['class']);$style = mysql_real_escape_string($_POST['style']);if ($_REQUEST['cmd'] == 'Add' && trim($name)){    $result = mysql_query("INSERT INTO panels (name , class , style) VALUES ('$name' , '$class' , '$style')");    if ($result)    {        ?>        <span class="Title" style="color: #339900;" >            پنل جدید با موفقیت ثبت شد        </span>        <script  type="text/javascript">                listPanels();        </script>        <?php        return;    }    else    {        ?>        <span class="Title" style="color: #dd2200;" >            خطا: پنل جدید ثبت نشد        </span>        <?php        return;    }}else if ($_REQUEST['cmd'] == 'Edit' && trim($name)){    $result = mysql_query("UPDATE panels SET name = '$name' , class = '$class' , style = '$style' WHERE id = '$panelId'");    if ($result)    {        ?>        <span class="Title" style="color: #339900;" >            پنل با موفقیت ویرایش شد        </span>        <span class="BackButton" onclick="seePanelInfo()"></span>        <script  type="text/javascript">                listPanels();        </script>        <?php        return;    }    else    {        ?>        <span class="Title" style="color: #dd2200;" >            خطا: پنل ویرایش نشد        </span>        <?php        return;    }}else if ($_REQUEST['cmd'] == 'Delete' && $panelId){    $result = mysql_query("DELETE FROM panels WHERE id = '$panelId'");    if ($result)    {        ?>        <span class="Title" style="color: #339900;" >            پنل با موفقیت حذف شد        </span>        <script  type="text/javascript">                listServices();        </script>        <?php        return;    }    else    {        ?>        <span class="Title" style="color: #dd2200;" >            خطا: پنل حذف نشد        </span>        <?php        return;    }}else if ($_REQUEST['cmd'] == 'SeePanelInfo'){    $result = mysql_query("SELECT * FROM panels WHERE id = '$panelId'") or die(mysql_error());    while ($row = mysql_fetch_array($result))    {        $name = $row['name'];        $class = $row['class'];        $style = $row['style'];        ?>        <span class="Title">            ویرایش پنل: <?php echo $name ?>        </span>        <span style="width: 100%; float: right;" id="FormContent">            <?php        }    }    else    {        ?>        <span class="Title">            پنل جدید        </span>        <span style="width: 100%; float: right;" id="FormContent">            <?php        }        if ($_REQUEST['cmd'] == 'SeePanelInfo')        {            ?>            <form action="#" method="POST" onsubmit="return editService()">                <?php            }            else            {                ?>                <form action="#" method="POST" onsubmit="return addService()">                    <?php                }                ?>                <span class="row">                    <span class="Label" style="width: 200px; text-align: right;">                        نام                    </span>                </span>                <span class="row">                    <input class="text-field" value="<?php echo $name ?>" id="name" style="width: 200px; direction: ltr;" >                </span>                   <span class="row">                    <span class="Label" style="width: 200px; text-align: left; direction: ltr;">                        class                    </span>                </span>                <span class="row">                    <input class="text-field" value="<?php echo $class ?>" id="class" style="width: 200px; direction: ltr;" onkeyup="setView()">                                    </span>                <span class="row">                    <span id="classValue" class="SmallLabel" style="width: 200px; direction: ltr; text-align: left;">                        <?php echo $class ?>                    </span>                </span>                <span class="row">                    <span class="Label" style="width: 414px; text-align: left; direction: ltr;">                        style                    </span>                </span>                <span class="row">                    <textarea class="text-field" id="style"                              style="width: 414px;                               max-width: 414px;                               min-width: 414px;                               min-height: 120px;                               direction: ltr;" onkeydown="ifShift(event)" onkeyup="setView() & nextLine(event)" ><?php echo $style ?></textarea>                </span>                <span class="row">                    <span class="Label">                        پیش نمایش                    </span>                </span>                <iframe class="row"                         id="fr"                         style="width:100%; border: none;                         margin: 0px; overflow: scroll; height: 300px; direction: ltr; background-image: url('styles/EditorBG.png')"                                                 src="WidgetsManagement/Editor.php?panelId=<?php echo $panelId ?>">                </iframe>                <input type="submit" style="display: none;" value="ثبت">                <?php                if ($_REQUEST['cmd'] == 'SeePanelInfo')                {                    ?>                    <span class="button green" style="float: left; margin: 10px;" title="ذخیره" onclick="editPanel()" >                        ذخیره                    </span>                    <span class="button Red"  onclick="deletePanel()" >                        حذف                    </span>                    <?php                }                else                {                    ?>                    <span class="button green" style="float: left; margin: 10px;" title="ثبت" onclick="addPanel()" >                        ثبت                    </span>                    <?php                }                ?>            </form>                        <?php            if (!$_REQUEST['cmd'])            {                ?>        </span>        <?php    }    ?>    <script  type="text/javascript">        function addPanel()        {            if(!obj('name').value)            {                obj('name').className = 'TextField Red';                return;            }            obj('name').className = 'TextField';            loadPage('WidgetsManagement/NEPanelForm.php', 'FormContent', 'cmd=Add&name='+obj('name').value+'&class='+obj('class').value+'&style='+obj('style').value );            return false;        }                         function editPanel()        {            if(!obj('name').value)            {                obj('name').className = 'TextField Red';                return;            }            obj('name').className = 'TextField';            loadPage('WidgetsManagement/NEPanelForm.php', 'FormContent', 'cmd=Edit&panelId=<?php echo $panelId ?>&name='+obj('name').value+'&class='+obj('class').value+'&style='+obj('style').value );            return false;        }                 function setView()        {                                 //obj('<?php // echo $styleId ? $styleId : 'testDiv'                      ?>').style.cssText = obj('style').value;            //obj('fr').contentDocument.body.innerHTML = '<link href="../templates/SpapcoDefault/template.css" rel="stylesheet" type="text/css">';            obj('fr').contentDocument.getElementById('dynamicStyle').innerHTML = obj('style').value;            obj('fr').contentDocument.getElementById('<?php echo $name ?>').className = 'Panel <?php echo $class ?> '+obj('class').value;            obj('classValue').innerHTML = 'Panel '+obj('class').value;                    }                var sh = false;        function ifShift(evt)        {            var theEvent = evt || window.event;            sh = theEvent.shiftKey;        }                function nextLine(evt)        {            var theEvent = evt || window.event;            var keycode = (theEvent.keyCode ? theEvent.keyCode : theEvent.which);                        if((keycode == 59 || keycode == 186) && !sh)            {                obj('style').value = obj('style').value+'\n ';                obj('style').setSelectionRange(obj('style').value.length - 1 , obj('style').value.length-1);            }                if((keycode == 59 || keycode == 186) && sh)            {                obj('style').value = obj('style').value + ' ';            }                    }                         </script>