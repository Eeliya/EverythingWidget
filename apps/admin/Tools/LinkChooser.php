<?phpsession_start();include($_SESSION['ROOT_DIR'] . '/config.php');$elementId = $_POST['elementId'];$parentId = mysql_real_escape_string($_POST['parentId']);$preParentId = '0';$result = mysql_query("SELECT * FROM content_categories WHERE id = '$parentId'") or die(mysql_error());while ($row = mysql_fetch_array($result)){  $preParentId = $row['parent_id'];}$parentDir = mysql_real_escape_string($_POST['parentDir']);$secId = mysql_real_escape_string($_POST['secId']);if ($_REQUEST['cmd'] == 'List'){  ?>  <div class="row purple" >    <a href="javascript:linkChooser.loadHome()" class="button" style="margin-left:5px;float:right;" >Home</a>    <?php    if ($parentId != $preParentId)    {      ?>      <a href="javascript:listCategories(<?php echo $preParentId; ?>)" class="button" style="margin-left:5px;float:right;"  >UP</a>      <?php    }    ?>  </div>  <div class="row" style="padding-bottom:0px;">    <label>      Sub folders    </label>  </div>  <div class="row" >    <table class="data">      <tr>        <th style="width: 50px;">          No        </th>        <th style="width: 200px;">          Title        </th>        <th>          Order        </th>                                              </tr>      <?php      $result = mysql_query("SELECT * FROM content_categories WHERE parent_id = '$parentId' ORDER BY content_categories.order") or die(mysql_error());      $rowNum = 1;      while ($row = mysql_fetch_array($result))      {        ?>		        <tr onclick="selectLinkRow(this, 'category/<?php echo $row['id']; ?>')" ondblclick="listCategories(<?php echo $row['id']; ?>)" >          <td><?php echo $rowNum++; ?></td>                      <td><?php echo $row['title']; ?></td>                      <td><?php echo $row['order']; ?></td>          </tr>        <?php      }      ?>    </table>  </div>  <?php  if ($parentId != $preParentId)  {    ?>    <div class="row" style="padding-bottom:0px;">      <label>        Articles      </label>    </div>            <div class="row">      <table class="data">        <tr>          <th style="width: 50px;">            No          </th>          <th style="width: 200px;">            Title          </th>          <th>            Order          </th>                                                </tr>        <?php        $result = mysql_query("SELECT * FROM contents WHERE category_id = '$parentId' ORDER BY contents.order") or die(mysql_error());        $rowNum = 1;        while ($row = mysql_fetch_array($result))        {          ?>		          <tr onclick="selectLinkRow(this, 'article/<?php echo $row['id']; ?>')" >            <td><?php echo $rowNum++; ?></td>                        <td><?php echo $row['title']; ?></td>                        <td><?php echo $row['order']; ?></td>                    </tr>          <?php        }        ?>      </table>    </div>    <?php  }  return;}if ($_REQUEST['cmd'] == 'Sections'){  ?>  <div class="row purple" >    <a href="javascript:linkChooser.loadHome()" class="button" style="margin-left:5px;float:right;" >Home</a>  </div>  <div class="row" >    <?php    if ($parentDir)    {      ?>      <span class="BackButton" style="margin-left: 5px;float:right;" onclick="listDir('', 0)" ></span>      <?php    }    ?>  </div>      <div class="row" style="padding-bottom:0px;">    <table class="data">      <tr>        <th style="width: 50px;">          No        </th>        <th style="width: 200px;">          Title        </th>      </tr>      <?php      $rowNum = 1;      $sections = getSections();      if ($parentDir)      {        $result = scandir($_SESSION['ROOT_DIR'] . '/sections' . $parentDir);        foreach ($result as $row)        {          if (!is_dir($_SESSION['ROOT_DIR'] . '/sections/' . $row . '/') && $row != 'admin')          {            $row = str_replace('.php', '', $row);            ?>		            <tr onclick="selectLinkRow(this, 'section/<?php echo $secId ?>/page/<?php echo str_replace('index', '', $row) ?>')" >              <td><?php echo $rowNum++; ?></td>                          <td><?php echo $row; ?></td>                          </tr>            <?php          }        }      }      else      {        while ($row = mysql_fetch_array($sections))        {          ?>		          <tr onclick="selectLinkRow(this, 'section/<?php echo $row['id'] ?>')" ondblclick="listDir('<?php echo '/' . $row['root_dir']; ?>', '<?php echo $row['id']; ?>')" >            <td><?php echo $rowNum++; ?></td>                        <td><?php echo $row['title']; ?></td>                        </tr>          <?php        }      }      ?>    </table>  </div>      <?php  return;}?><div id="home-items" style="display:none;">  <ul class="items" >    <li>      <a  href="javascript:void(0)"           onclick="listCategories(0)">        Contents      </a>    </li>    <li>      <a   href="javascript:void(0)"            onclick="loadPage('Tools/LinkChooser.php', 'Result', 'cmd=Sections');">        Sections      </a>    </li>    <li>      <div class="row">        <label for="externalLink">          External link        </label>          <input class="text-field" style="width:450px;" name="externalLink" id="externalLink">                </div>    </li>  </ul></div><h1>  Select Link</h1><div id="Result" class="form-content">        </div><div class="footer-pane">  <a id="SelectBtn" href="javascript:void(0)" class="button green" onclick="selectPath()">    Done  </a></div><script lang="javascript" type="text/javascript">      var oldLinkRow;      var path;      function LinkChooser()      {      }      function selectLinkRow(rowElm, p)      {        $(oldLinkRow).removeClass("selected");        $(rowElm).addClass("selected");        oldLinkRow = rowElm;        path = p;      }      function setPath(p)      {        path = p;      }      function selectPath()      {        if ($("#externalLink").val())        {          path = $("#externalLink").val();        }        $('#<?php echo $elementId ?>').val(path);        if (afterSelectPath)          afterSelectPath('<?php echo $elementId ?>');      }      function listCategories(perId)      {        $("#Result").html("<span class='LoadingAnimation'></span>");        $.post('Tools/LinkChooser.php', {cmd: "List", parentId: perId}, function(data) {          $("#Result").html(data);        });      }      function listDir(parentDir, secId)      {        $("#Result").html("<span class='LoadingAnimation'></span>");        $.post('Tools/LinkChooser.php', {cmd: "Sections", parentDir: parentDir, secId: secId}, function(data) {          $("#Result").html(data);        });      }      LinkChooser.prototype.loadHome = function()      {        $("#Result").css({display: "none"});        $("#Result").html($("#home-items").html());        $("#Result").fadeIn(500);      };      var linkChooser = new LinkChooser();      linkChooser.loadHome();</script>