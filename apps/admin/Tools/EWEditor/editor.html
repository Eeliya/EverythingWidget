<!DOCTYPE html>
<html>
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
      <link rel='stylesheet' href="../../../core/css/bootstrap.css"/>
      <link rel='stylesheet' href="medium-editor.css"/>
      <link rel='stylesheet' href="default.css"/>
      <script src="../../../core/js/jquery/jquery-2.1.1.min.js"></script>        

      <script src="mjbp.js"></script>
      <style>
         html, body{padding:10px 2px;margin:0px;} 
         body{padding-top:30px;}
         .container{width:100%;}
         #container{border:2px solid #aaa;padding-bottom:108px;}
         #container:focus{outline:none;border-color:#333;}
         //p{outline:1px dashed #aaa} 
         .row{border:2px solid #ccc;padding-bottom:54px;margin-bottom:-54px;} 
         .row:focus, .row.active{outline:none;border-color:#333;}
         .row:before {content: 'ROW';line-height: 20px;display:block;padding:0px 4px;  font-size: 11px;  font-weight: bold;}
         .column{border:2px solid rgba(0,0,0,.1);padding-top:20px;min-height:44px;padding-bottom:54px;}
         .column:focus:before, .column.active:before{background-color:#3cf;}
         .column:focus, column.active{border-color:#3cf;outline:none;}
         .column:before {content: 'COLUMN';line-height: 20px;display:block;padding:0px 4px;font-size: 11px;font-weight:bold;background-color: rgba(0,0,0,.1);margin:-20px -15px 0;}
         .control-row{padding:10px;background-color:rgba(240,240,240,.9);position:absolute;z-index:5;}
         .control-row .btn{float:none;margin:0px auto;display:block;}
      </style>

      <script>
         $(document).ready(function () {
            //CKEDITOR.disableAutoInline = true;

            Editor =
                    {
                       activeElement: null,
                       controlRow: $("#control-row"),
                       eventHandlers: [],
                       addColumn: function (row)
                       {
                          var self = this;
                          var col = $("<div class='col-xs-12 pull-left column' tabindex='1' contenteditable='true'></div>");

                          col.on('focus', function (e)
                          {
                             col.addClass('active');
                             if (self.activeElement)
                                self.activeElement.removeClass('active');
                             self.activeElement = col;
                             self.triggerSelectElement();
                             e.preventDefault();
                          });
                          col.on('blur', function (e)
                          {

                          });
                          this.addElement(col, row);
                          return col;
                       },
                       addRow: function (col)
                       {
                          var self = this;
                          var row = $("<div class='row' tabindex='1'>");

                          row.on('focus', function (e)
                          {
                             row.addClass('active');
                             if (self.activeElement)
                                self.activeElement.removeClass('active');
                             self.activeElement = row;
                             self.triggerSelectElement();
                          });
                          row.on('blur', function (e)
                          {

                          });
                          this.addElement(row, col);
                          return row;
                       },
                       selectElement: function (e)
                       {
                          /*console.log(e);
                           if (e)
                           $('.row').notebook();*/
                       },
                       addElement: function (e, p)
                       {
                          if (p)
                             p.append(e);
                          else
                          {
                             $("#container").append(e);
                          }
                          e.focus();
                          var ce = $("#container")[0];
                          if (ce.setSelectionRange) {
                                ce.focus();
                                ce.setSelectionRange(0, 0);
                             }
                             else if (ce.createTextRange) {
                                var range = ce.createTextRange();
                                range.collapse(true);
                                range.moveEnd('character', 0);
                                range.moveStart('character', 0);
                                range.select();
                             }
                          
                          return e;
                       },
                       triggerSelectElement: function (content)
                       {
                          $(document.body).trigger('element-select', [this.activeElement]);
                          //console.log("sss");
                          for (var i = 0; i < this.eventHandlers.length; i++)
                          {
                             this.eventHandlers[i].action.call(this, this.activeElement);
                          }
                          //if (this.activeElement)
                          //this.iFrame[0].contentWindow.Editor.selectElement(this.activeElement);

                       },
                       on: function (name, action)
                       {
                          this.eventHandlers.push({name: name, action: action});
                       },
                       init: function ()
                       {
                          var self = this;
                          var ce = $("#container")[0];
                          $("#container").on('focus', function ()
                          {
                             if (self.activeElement)
                                self.activeElement.removeClass('active');
                             self.activeElement = $("#container");
                             self.triggerSelectElement();

                             if (ce.setSelectionRange) {
                                ce.focus();
                                ce.setSelectionRange(0, 0);
                             }
                             else if (ce.createTextRange) {
                                var range = ce.createTextRange();
                                range.collapse(true);
                                range.moveEnd('character', 0);
                                range.moveStart('character', 0);
                                range.select();
                             }
                          });
                       }
                    }
            Editor.init();

            var textEditor = new MJEditor(document.getElementById("container"), {
               buttons: ['b', 'i', 'blockquote', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'ol', 'ul', 'a', 'cancel', 'back', 'enter']
            });
            /*var editor = new MJEditor(document.getElementById("container"), {
             buttons: ['b', 'i', 'blockquote', 'h1', 'h2', 'h3', 'h4', 'h5', 'h6', 'ol', 'ul', 'a', 'cancel', 'back', 'enter']
             });*/
         });
         //console.log($(document));
      </script>
   </head>
   <body>
      <div id="editor">
         <div id="editor-mask">
            <div class="editor-buttons">
               <button id="editor-b" data-command="bold"><i class="fa fa-bold"></i></button>
               <button id="editor-i" data-command="italic"><i class="fa fa-italic"></i></button>
               <button id="editor-blockquote" data-command="quote"><i class="fa fa-quote-left"></i></button>
               <button class="heading" id="editor-h1" data-command="h1"><i class="fa fa-header"></i>1</button>
               <button class="heading" id="editor-h2" data-command="h2"><i class="fa fa-header"></i>2</button>
               <button class="heading" id="editor-h3" data-command="h3"><i class="fa fa-header"></i>3</button>
               <button class="heading" id="editor-h4" data-command="h4"><i class="fa fa-header"></i>4</button>
               <button class="heading" id="editor-h5" data-command="h5"><i class="fa fa-header"></i>5</button>
               <button class="heading" id="editor-h6" data-command="h6"><i class="fa fa-header"></i>6</button>
               <button id="editor-ol" data-command="ol"><i class="fa fa-list-ol"></i></button>
               <button id="editor-ul" data-command="ul"><i class="fa fa-list-ul"></i></button>
               <button id="editor-a" data-command="a"><i class="fa fa-link"></i></button>

            </div>
            <div id="editor-link-field-holder">
               <input type="text" id="editor-link-field" placeholder="Type or paste link">
               <button id="editor-cancel" data-command="cancel"><i class="fa fa-unlink"></i></button>
               <button id="editor-back" data-command="back"><i class="fa fa-arrow-left"></i></button>
               <button class="pull-right" id="editor-enter" data-command="enter"><i class="fa fa-check"></i></button>
            </div>
         </div>
      </div>
      <div id='container' class='container' tabindex="1">

      </div>
      <div id="control-row" class='control-row' >
         <button class='btn btn-info'><i class='fa fa-plus fa-lg'></i></button>
      </div>
   </body>
</html>
